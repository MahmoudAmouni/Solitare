import{readScores,createScore,deleteScore}from"./api.js";const PAGE_SIZE=5;let pendingDeleteId=null,currentPage=0,allScores=[];document.addEventListener("DOMContentLoaded",(async()=>{const e=document.querySelector("tbody"),t=document.querySelector("#scoreTable"),n=document.querySelector("#tableButtons"),s=document.querySelectorAll(".addScore"),l=document.getElementById("formContainer"),d=document.querySelector(".scoreForm"),o=document.getElementById("confirmDelete"),c=document.getElementById("cancelDelete"),r=document.getElementById("prevPage"),a=document.getElementById("nextPage");async function i(){const e=await readScores();e.sort(((e,t)=>t.score!==e.score?t.score-e.score:e.duration-t.duration)),allScores=e,currentPage=0,u()}function u(){const s=5*currentPage,l=s+5,d=allScores.slice(s,l);if(0===allScores.length)return t.style.display="none",n.style.display="none",r.style.display="none",a.style.display="none",void(noScoresMessage.style.display="block");t.style.display="table",noScoresMessage.style.display="none",n.style.display="flex",e.innerHTML="",d.forEach(((t,n)=>{const l=s+n,d=Math.floor(t.duration/60),o=t.duration%60;let c="";c+=0===l?'<tr class="first"><td>ğŸ‘‘</td>':1===l?'<tr class="second"><td>ğŸ¥ˆ</td>':2===l?'<tr class="third"><td>ğŸ¥‰</td>':`<tr><td>${l+1}</td>`,c+=`\n      <td>${t.userName}</td>\n      <td>${t.score}</td>\n      <td>${d} min ${o} sec</td>\n      <td><button class="trashButton" data-id="${t.id}"><i class="fas fa-trash"></i></button></td>\n    </tr>`,e.innerHTML+=c})),document.querySelectorAll(".trashButton").forEach((e=>{e.addEventListener("click",(async()=>{!function(e){pendingDeleteId=e,document.body.classList.add("no-scroll"),document.getElementById("deleteOverlay").classList.add("show")}(e.dataset.id)}))})),r.style.display=0===currentPage?"none":"inline-block",a.style.display=l>=allScores.length?"none":"inline-block"}function y(){document.getElementById("deleteOverlay").classList.remove("show"),document.body.classList.remove("no-scroll"),pendingDeleteId=null}function m(e){const t=document.getElementById("toast");t.innerHTML=e,t.classList.add("show"),setTimeout((()=>{t.classList.remove("show")}),2500)}o.addEventListener("click",(async()=>{pendingDeleteId&&(await deleteScore(pendingDeleteId),i(),y(),m("Score Deleted Successfully"))})),c.addEventListener("click",(()=>{y()})),s.forEach((e=>{e.addEventListener("click",(()=>{"flex"===l.style.display?(l.style.display="none",e.textContent="Add Score"):l.style.display="flex"}))})),d.addEventListener("submit",(async e=>{e.preventDefault();const t=e.target.userName.value.trim();if(!t)return;await createScore(t)&&(m("New record loaded successfullyğŸƒ"),i(),e.target.reset()),l.style.display="none"})),document.body.addEventListener("click",(function(e){"flex"!==l.style.display||e.target.closest(".insideForm")||e.target.closest(".addScore")||(l.style.display="none",s.forEach((e=>{e.textContent="Add Score"})))})),document.getElementById("prevPage").addEventListener("click",(()=>{currentPage>0&&(currentPage--,u())})),document.getElementById("nextPage").addEventListener("click",(()=>{const e=Math.ceil(allScores.length/5)-1;currentPage<e&&(currentPage++,u())})),i()}));